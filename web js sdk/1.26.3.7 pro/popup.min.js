!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():t()}(this,function(){"use strict";function e(e){this.properties=e.properties,this.template=e.template,this.maskEle=null,this.containerEle=null,this.msg={$sf_msg_title:"",$sf_msg_content:"",$sf_msg_image_url:"",$sf_succeed:"",$sf_fail_reason:"",$sf_msg_id:"",plan:{}},this.popupCheckInstance=null}function t(e){var t="t6KJCZa5pDdQ9khoEM3Tj70fbP2eLSyc4BrsYugARqFIw1mzlGNVXOHiWvxUn8",n=t.length-1,i={},o=0;for(o=0;o<t.length;o++)i[t.charAt(o)]=t.charAt(n-o);var a="";for(o=0;o<e.length;o++)a+=e.charAt(o)in i?i[e.charAt(o)]:e.charAt(o);return a}function n(e){return 0===e.indexOf(c)&&(e=e.substring(c.length),e=t(e)),e}function i(e){return c+t(e)}function o(){if(!a.isSupportPopup())return!1;if(window.screen.width&&Number(window.screen.width)>1024)return"object"==typeof console&&console.log&&console.log("H5 \u5f39\u7a97\u4ec5\u652f\u6301\u79fb\u52a8\u7aef\u548c ipad\uff0c\u6216\u8005\u5c4f\u5e55\u5bbd\u5ea6\u5c0f\u4e8e\u7b49\u4e8e 1024\u3002"),!1;var e={};return arguments.length>0&&(1===arguments.length&&r.isObject(arguments[0])?e=arguments[0]:arguments.length>=2&&r.isObject(arguments[1])&&(e=arguments[1])),!!this.setPara(e)&&(a.info.platform="H5",!!a.setIsLoad()&&(!!this.getBridgeState()&&void(a.testSend.hasParam()?a.testSend.start():(a.listenPageStateChange(),a.updateDataAndSetListen.initial()))))}var a={sa:{},info:{},plugin_name:"WebPopup",lib_version:"1.26.3.7",plugin_version:"1.26.3.7",defaultPara:{platform:"H5",preload_image:!0,encrypt_cookie:!1},serverData:{},localData:{global_popup_count:[],local_update_time:null,eventQueue:[],update_time:null},eventRule:{},convertPlans:[],isRun:!1,setArg:function(e){var t={};if(e&&"[object Object]"===Object.prototype.toString.call(e)){for(var n in e)n&&"popup_window_content"!==n&&(t[n]=e[n]);return JSON.stringify(t,null,"  ")}return e},log:function(){if(a.info.show_log===!0&&"object"==typeof console&&"function"==typeof console.log)try{return arguments[0]=a.setArg(arguments[0]),arguments[1]=a.setArg(arguments[1]),console.log.apply(console,arguments)}catch(e){console.log(arguments[0])}}};a.config={storageName:"universalstatistics202002-popupdata",loadedSign:"UniversalStatistics2015JSSDKH5PopupIsLoad"};var r={visibility:function(e){e=e||{};var t={hidden:void 0,visibilityChange:void 0,isSupported:function(){return"undefined"!=typeof this.hidden},_visible:e.onVisible,_hidden:e.onHidden,_nativeSwitch:function(){document[this.hidden]===!0?this._hidden():this._visible()},listen:function(){try{this.isSupported()?document.addEventListener(this.visibilityChange,function(){t._nativeSwitch.apply(t,arguments)},1):document.addEventListener?(window.addEventListener("focus",this._visible,1),window.addEventListener("blur",this._hidden,1)):(document.attachEvent("onfocusin",this._visible),document.attachEvent("onfocusout",this._hidden))}catch(e){}},init:function(){"undefined"!=typeof document.hidden?(this.hidden="hidden",this.visibilityChange="visibilitychange"):"undefined"!=typeof document.mozHidden?(this.hidden="mozHidden",this.visibilityChange="mozvisibilitychange"):"undefined"!=typeof document.msHidden?(this.hidden="msHidden",this.visibilityChange="msvisibilitychange"):"undefined"!=typeof document.webkitHidden&&(this.hidden="webkitHidden",this.visibilityChange="webkitvisibilitychange"),this.listen()}};t.init()},getRgba:function(e){return"object"!=typeof e?e:"rgba("+e.r+","+e.g+","+e.b+","+e.a+")"},conversionNum:function(e){if(e){if(/^[0|1]?\.\d+$/.test(e))return 100*Number(e)+"%";var t=/^(-?\d+(\.\d+)?)px$/.exec(e);return t?(Number(t[1])/375*window.screen.width).toFixed(2)+"px":e}},boxModel:function(e){return function(t){if("object"!=typeof t)return e+":"+t+";";var n="";for(var i in t)n+=e+"-"+i+":"+r.conversionNum(t[i])+";";return n}},localStorage:{get:function(e){return window.localStorage.getItem(e)},parse:function(e){var t=null;try{t=JSON.parse(r.localStorage.get(e))||null}catch(n){}return t},set:function(e,t){window.localStorage.setItem(e,t)},remove:function(e){window.localStorage.removeItem(e)},isSupport:function(){var e=!0;try{var t="__universalstatisticssupport__",n="testIsSupportStorage";r.localStorage.set(t,n),r.localStorage.get(t)!==n&&(e=!1),r.localStorage.remove(t)}catch(i){e=!1}return e}},addEvent:function(){function e(t){return t&&(t.preventDefault=e.preventDefault,t.stopPropagation=e.stopPropagation,t._getPath=e._getPath),t}function t(t,n,i){var o=function(o){if(o=o||e(window.event)){o.target=o.srcElement;var a,r,s=!0;return"function"==typeof i&&(a=i(o)),r=n.call(t,o),!1!==a&&!1!==r||(s=!1),s}};return o}e._getPath=function(){var e=this,t=function(){try{var t=e.target,n=[t];if(null===t||null===t.parentElement)return[];for(;null!==t.parentElement;)t=t.parentElement,n.unshift(t);return n}catch(i){return[]}};return this.path||this.composedPath&&this.composedPath()||t()},e.preventDefault=function(){this.returnValue=!1},e.stopPropagation=function(){this.cancelBubble=!0};var n=function(n,i,o){if(n&&n.addEventListener)n.addEventListener(i,function(t){t._getPath=e._getPath,o.call(this,t)},!1);else{var a="on"+i,r=n[a];n[a]=t(n,o,r)}};n.apply(null,arguments)},extend:function(e){var t=Array.prototype.slice;return r.each(t.call(arguments,1),function(t){for(var n in t)void 0!==t[n]&&(e[n]=t[n])}),e},extend2Lev:function(e){return r.each(Array.prototype.slice.call(arguments,1),function(t){for(var n in t)void 0!==t[n]&&(r.isObject(t[n])&&r.isObject(e[n])?r.extend(e[n],t[n]):e[n]=t[n])}),e},each:function(e,t,n){var i=Object.prototype.hasOwnProperty,o=Array.prototype.forEach,a={};if(null==e)return!1;if(o&&e.forEach===o)e.forEach(t,n);else if(e.length===+e.length){for(var r=0,s=e.length;r<s;r++)if(r in e&&t.call(n,e[r],r,e)===a)return!1}else for(var p in e)if(i.call(e,p)&&t.call(n,e[p],p,e)===a)return!1},xhr:function(e){if(e)return"undefined"!=typeof window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest?new XMLHttpRequest:"undefined"!=typeof XDomainRequest?new XDomainRequest:null;if("undefined"!=typeof window.XMLHttpRequest)return new XMLHttpRequest;if(window.ActiveXObject)try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}},ajax:function(e){function t(e){if(!e)return"";try{return JSON.parse(e)}catch(t){return{}}}function n(){try{r.isObject(i)&&i.abort&&i.abort()}catch(t){sd.log(t)}o&&(clearTimeout(o),o=null,e.error&&e.error(),i.onreadystatechange=null,i.onload=null,i.onerror=null)}e.timeout=e.timeout||2e4,e.credentials="undefined"==typeof e.credentials||e.credentials;var i=r.xhr(e.cors);if(!i)return!1;e.type||(e.type=e.data?"POST":"GET"),e=r.extend({success:function(){},error:function(){}},e);var o,a=e.success,s=e.error;e.success=function(e){a(e),o&&(clearTimeout(o),o=null)},e.error=function(e){s(e),o&&(clearTimeout(o),o=null)},o=setTimeout(function(){n()},e.timeout),"undefined"!=typeof XDomainRequest&&i instanceof XDomainRequest&&(i.onload=function(){e.success&&e.success(t(i.responseText)),i.onreadystatechange=null,i.onload=null,i.onerror=null},i.onerror=function(){e.error&&e.error(t(i.responseText),i.status),i.onreadystatechange=null,i.onerror=null,i.onload=null}),i.onreadystatechange=function(){try{4==i.readyState&&(i.status>=200&&i.status<300||304==i.status?e.success(t(i.responseText)):e.error(t(i.responseText),i.status),i.onreadystatechange=null,i.onload=null)}catch(n){i.onreadystatechange=null,i.onload=null}},i.open(e.type,e.url,!0);try{e.credentials&&(i.withCredentials=!0),r.isObject(e.header)&&r.each(e.header,function(e,t){i.setRequestHeader&&i.setRequestHeader(t,e)}),e.data&&(e.cors||i.setRequestHeader&&i.setRequestHeader("X-Requested-With","XMLHttpRequest"),"application/json"===e.contentType?i.setRequestHeader&&i.setRequestHeader("Content-type","application/json; charset=UTF-8"):i.setRequestHeader&&i.setRequestHeader("Content-type","application/x-www-form-urlencoded"))}catch(p){sd.log(p)}i.send(e.data||null)},getUuid:function(){var e=function(){for(var e=1*new Date,t=0;e==1*new Date;)t++;return e.toString(16)+t.toString(16)},t=function(){return Math.random().toString(16).replace(".","")};return function(){var n=e()+"-"+t()+"-"+t();return n?n:(String(Math.random())+String(Math.random())+String(Math.random())).slice(2,15)}},trim:function(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},isEmptyObject:function(e){var t=Object.prototype.hasOwnProperty;if(r.isObject(e)){for(var n in e)if(t.call(e,n))return!1;return!0}return!1},filter:function(e,t,n){var i=Object.prototype.hasOwnProperty;if(e.filter)return e.filter(t);for(var o=[],a=0;a<e.length;a++)if(i.call(e,a)){var r=e[a];t.call(n,r,a,e)&&o.push(r)}return o},isObject:function(e){return null!=e&&"[object Object]"==Object.prototype.toString.call(e)},getConvertNumberValue:function(e){return r.isString(e)&&(e=Number(e)),Math.floor(1e3*e)/1e3},isArray:Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},isString:function(e){return"[object String]"==Object.prototype.toString.call(e)},isDate:function(e){return"[object Date]"==Object.prototype.toString.call(e)},isBoolean:function(e){return"[object Boolean]"==Object.prototype.toString.call(e)},isNumber:function(e){return"[object Number]"==Object.prototype.toString.call(e)&&/[\d\.]+/.test(String(e))},isFunction:function(e){if(!e)return!1;var t=Object.prototype.toString.call(e);return"[object Function]"==t||"[object AsyncFunction]"==t},getURLSearchParams:function(e){e=e||"";for(var t=function(e){return decodeURIComponent(e)},n={},i=e.substring(1),o=i.split("&"),a=0;a<o.length;a++){var r=o[a].indexOf("=");if(r!==-1){var s=o[a].substring(0,r),p=o[a].substring(r+1);s=t(s),p=t(p),n[s]=p}}return n},URL:function(e){var t={},n=["hash","host","hostname","href","origin","password","pathname","port","protocol","search","username"],i=function(){var e;try{return e=new URL("https://www.google.com"),"https://www.google.com"===e.href}catch(t){return!1}};if("function"==typeof window.URL&&i())t=new URL(e),t.searchParams||(t.searchParams=function(){var e=r.getURLSearchParams(t.search);return{get:function(t){return e[t]}}}());else{var o=/^https?:\/\/.+/;if(o.test(e)===!1)throw"Invalid URL";var a=document.createElement("a");a.href=e;for(var s=n.length-1;s>=0;s--){var p=n[s];t[p]=a[p]}t.hostname&&"string"==typeof t.pathname&&0!==t.pathname.indexOf("/")&&(t.pathname="/"+t.pathname),t.searchParams=function(){var e=r.getURLSearchParams(t.search);return{get:function(t){return e[t]}}}()}return t},contentLoaded:function(e,t){var n=!1,i=!0,o=e.document,a=o.documentElement,r=o.addEventListener,s=r?"addEventListener":"attachEvent",p=r?"removeEventListener":"detachEvent",l=r?"":"on",u=function(i){"readystatechange"==i.type&&"complete"!=o.readyState||(("load"==i.type?e:o)[p](l+i.type,u,!1),!n&&(n=!0)&&t.call(e,i.type||i))},c=function(){try{a.doScroll("left")}catch(e){return void setTimeout(c,50)}u("poll")};if("complete"==o.readyState)t.call(e,"lazy");else{if(!r&&a.doScroll){try{i=!e.frameElement}catch(_){}i&&c()}o[s](l+"DOMContentLoaded",u,!1),o[s](l+"readystatechange",u,!1),e[s](l+"load",u,!1)}},indexOf:function(e,t){var n=e.indexOf;if(n)return n.call(e,t);for(var i=0;i<e.length;i++)if(t===e[i])return i;return-1}};a._=r,a.isSupportPopup=function(){return r.localStorage.isSupport()},a.listenPageStateChange=function(){var e=!0;r.visibility({onVisible:function(){a.log("\u9875\u9762\u89e6\u53d1visible-",(new Date).getMinutes(),"\u5206",(new Date).getSeconds()),e===!1&&(a.updateDataAndSetListen.startState(),e=!0)},onHidden:function(){a.log("\u9875\u9762\u89e6\u53d1hidden-",(new Date).getMinutes(),"\u5206",(new Date).getSeconds()),e===!0&&(a.updateDataAndSetListen.stopAllState(),e=!1)}})},a.getWebSDK=function(){return!!(r.isObject(window.UniversalStatistics201505)&&r.isObject(window.UniversalStatistics201505.readyState)&&window.UniversalStatistics201505.readyState.state>=3)&&window.UniversalStatistics201505},a.getPopupInfo=function(e){function t(e){r.each(e.subviews,function(e){var i=e.properties||{};"title"===i.msgType?n.$sf_msg_title=i.text:"content"===i.msgType?n.$sf_msg_content=i.text:"image"===e.type&&(n.$sf_msg_image_url=i.image),e.subviews&&t(e)})}if(!r.isObject(e)||!r.isObject(e.template))return{};var n={$sf_msg_title:"",$sf_msg_content:"",$sf_msg_image_url:""};return t(e.template),n},a.getSFCampaign=function(e){e=r.isObject(e)?e:{};var t={planId:"",name:"",content:null,type:""};return t.planId=e.plan_id||"",t.name=e.cname||"",t.content=r.isObject(e.popup_window_content)?e.popup_window_content.content:"",t.type=r.isObject(e.popup_window_content)&&e.popup_window_content.popup_type?e.popup_window_content.popup_type:"PRESET",t},a.getImageList=function(e){if(!r.isArray(e))return!1;for(var t,n,i=new RegExp('("(backgroundImage|image)":"(http(s)?://.[^"]*)")',"g"),o=new RegExp('http(s)?://.[^S^"]*'),a={},s=e.length,p=[],l=!1,u=0;u<s;u++)if(r.isObject(e[u])&&"ACTIVE"===e[u].status.toLocaleUpperCase()&&e[u].is_audience===!0&&(l=e[u].strategy_id?e[u].is_trigger!==!1:e[u].is_control_group!==!0,l&&e[u].popup_window_content&&e[u].popup_window_content.content&&(t=e[u].popup_window_content.content.match(i))))for(var c=0,_=t.length;c<_;c++)n=t[c].match(o),n&&n.length>0&&(a[n[0]]||(a[n[0]]=1));return r.each(a,function(e,t){p.push(t)}),p},a.setIsLoad=function(){var e=window.self===window.top;if(e){if(window[a.config.loadedSign])return!1;if("undefined"==typeof window[a.config.loadedSign])return window[a.config.loadedSign]=!0,!0}else try{return!window.top[a.config.loadedSign]&&(window.top[a.config.loadedSign]=!0,!0)}catch(t){return a.log("\u975e\u540c\u57df\u540diframe\u5185\u5d4c\u4e0d\u80fd\u83b7\u53d6\u7236\u7ea7\u7a97\u4f53\u5185\u5bb9",t),!0}};var s={close:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFoAAABaCAMAAAAPdrEwAAAAe1BMVEUAAAD////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////NgkbwAAAAKHRSTlMA5if6t/B0UjMSxpAtJB4MBfTr30oY6NjV0r2loZ6XkoaBenFp3UA/LNePaQAAAsxJREFUWMOsltlygzAMRRXMZsAsAZJmX9v6/7+wg1QXpjGxCDkvyWTIQZauDcCgzKLrPtnUSyGW9SbZX6OshDcQh36lH6j8MJ7pTZd6lGX6sr0IP7SDj7CA6chLoBkEFzm14nM1/P/2eGti1RZFq+LmdtwGw7afJ1Ue1dogcGCW4QptqCO2OPe1IbnL0Y7dE23wc2bJgSn44MFTvIMwLeMUXqZGfGKUkp+MPC2dwUjMGhWwUL7pnXRUsdbIIpow84VG1k9Xmf1e5U8Kq/R/68memAPqcggTCQUNc9SdL+iCL5jMd0B1j/RErh3LYrRyLa2po2x8KngJ9Uk5sWUwpZoVvIiiulNLhMwgHDhDED2MEH8X3zCDL4HV/R8lRTOEWYS0KWzt8GEm/mNLihpHKOeqJY6yLqDnbO42F1r9eXCzitMOfkuqfvkXTId6h1phSi5/ncbgneAtnDCAxTAzIn+POhfDFOObzAEsNLu0HXO06a4BCwd89wEk1h2ezdwl0rObvS5nNreHurg/lxKwsNPoHjXrHVhI+lMK3xjvMH4YelYzCSzc8V3zrx9CWtu5MG67eWEdhBSmI+GT7eIZt+Nny7YJ+y8ON9/cF1tWVL7LzTdTi6sSMtw9AE432wwl7u6MzqotMNwcM7Glc/TafRyB4+aa4dhdcoV993EDlptphlt3zZ72TgM8N88MDe3vDQWE5V6tWGaKyAbwqaiA5+aZQeETkk6QFtxuvhlaOkVwwxfgdq/IvHKbocBj6ac5OzYCIASBKGo10n+HBgakMswbaYDgTmX3fzgafhD4G+Hhg1cGXnT4PMFHVayCdVcBXGBu7cKwACOOC2YwTsIQ7KI7LBywJrlyByupK9Kw/lto4VFLAqLdmRwJiBDWwjDOI0QPPhPXRn3yTlyrILND4w7oOw3h5AlTPk5U/ddrZSk4RWW+C9hp2rgru6GiP/678n2UFPV1AAAAAElFTkSuQmCC"},p={row:"div",column:"div",label:"pre",image:"img",button:"button",link:"button",image_button:"img"},l={textAlign:"text-align",font:"font-size",backgroundColor:"background-color",borderWidth:function(e){return"border-width: "+e+";border-style: solid;"},borderColor:"border-color",cornerRadius:"border-radius",backgroundImage:function(e){return"background-image:url("+e+");background-repeat: no-repeat;background-size: 100% 100%;"},margin:r.boxModel("margin"),padding:r.boxModel("padding"),maxHeight:"max-height",maxWidth:"max-width",scrollableX:function(e){if(e)return"overflow-x:auto;"},scrollableY:function(e){if(e)return"overflow-y:auto;"}};e.prototype={constructor:e,render:function(){function e(e,n){var i=e.maskAction.H5,o=r.isArray(i)&&i[0];if(r.isObject(o))switch(n.$sf_close_type=o.$sf_close_type||"",n.$sf_msg_element_action=o.type||"",o.type){case"copy":a.track.trackEvent("$PlanPopupClick",n,t.msg);break;case"customize":case"openlink":a.track.trackEvent("$PlanPopupClick",n,t.msg),o.closeable&&t.destory();break;case"close":o.closeable&&(a.track.trackEvent("$PlanPopupClick",n,t.msg),t.destory())}}var t=this,n=document.querySelector("div[data-sf-mask]");return!n&&(t.template.isRoot=!0,t.containerEle=t.createView(t.template),t.maskEle=t.getElement({nodeName:"div",attr:{"data-universal-click":!0},style:t.getStyle({position:"fixed",width:"100%",height:"100%",top:"0px",left:"0px",backgroundColor:r.getRgba(t.properties.maskColor),"z-index":999998})}),r.addEvent(t.maskEle,"click",function(n){var i=n.target,o=i.getAttribute("data-ele-mask"),r=t.properties,s=t.msg;if(!s)return!1;var p={$sf_close_type:"POPUP_CLOSE_MASK",$sf_msg_title:s.$sf_msg_title,$sf_msg_content:s.$sf_msg_content,$sf_msg_image_url:s.$sf_msg_image_url,$sf_msg_element_action:"close",$sf_msg_element_type:"mask",$sf_msg_action_id:r.maskActionId};return o&&r&&r.maskAction?(e(r,p),!1):o&&t.properties.maskCloseEnabled?(a.track.trackEvent("$PlanPopupClick",p,s),t.destory(),!1):void a.track.elementClickCallback(n,t)}),t.maskEle.setAttribute("data-sf-mask",!0),t.maskEle.appendChild(t.containerEle),r.contentLoaded(window,function(){t.appendPopup()}),!0)},appendPopup:function(){if(window.self===window.top)document.body.appendChild(this.maskEle);else try{window.top.document.body.appendChild(this.maskEle)}catch(e){document.body.appendChild(this.maskEle)}var t=document.querySelector("[data-ele-mask] > div"),n=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;t&&t.offsetHeight>n&&(t.style.marginTop="auto")},getElement:function(e){var t=e.nodeName||"div",n=e.style,i=e.attr,o=e.prop,a=e.child,s=e.action,p=e.element_info,l=document.createElement(t);return n&&l.setAttribute("style",n),i&&r.each(i,function(e,t){e&&l.setAttribute(t,e)}),o&&r.each(o,function(e,t){e&&(l[t]=e)}),a&&a.length&&r.each(a,function(e){return!!e&&void l.appendChild(e)}),s&&s.H5&&s.H5.length&&l.setAttribute("data-action",JSON.stringify(s.H5)),p&&l.setAttribute("data-info",JSON.stringify(p)),l},getStyle:function(e){var t="",n=["msgType","text","image","name","isHidden","align","localImageName"];return r.each(e,function(e,i){var e=r.conversionNum(e),o=l[i];return!(r.indexOf(n,i)>=0)&&void(t+=r.isString(o)?o+":"+r.getRgba(e)+";":r.isFunction(o)?o(e)+";":i+":"+r.getRgba(e)+";")}),t},createView:function(e){var t=[],n={"box-sizing":"border-box",display:"block","pointer-events":"auto",overflow:"hidden"},i={},o={},a=p[e.type]||null;e.properties=e.properties||{},e.layout=e.layout||{};var l=e.properties.font,u=l?1.7*parseInt(l)+"px":"normal";if(e.properties.isHidden)return!1;switch(e.properties.text?o.innerText=e.properties.text:e.properties.image&&(i["data-universal-click"]=!0,e.properties.localImageName?i.src=s[e.properties.localImageName]:i.src=e.properties.image),e.isRoot&&(e.layout.margin.top="-40px",r.extend(n,{position:"relative","z-index":999999,"pointer-events":"none"})),e.type){case"row":n.display="flex";break;case"link":r.extend(n,{"text-decoration":"underline",outline:"none","letter-spacing":"1px","line-height":u});break;case"label":r.extend(n,{"white-space":"pre-wrap","word-wrap":"break-word","letter-spacing":"1px","line-height":u,"margin-top":"0px","margin-bottom":"0px"});break;case"button":r.extend(n,{outline:"none","letter-spacing":"1px","line-height":u})}r.extend(n,e.layout,e.properties),e.subviews&&e.subviews.length>0&&r.each(e.subviews,function(e){t.push(this.createView(e))},this);var c=this.getElement({element_info:{$sf_msg_element_type:e.type,$sf_msg_element_content:e.properties.text||""},nodeName:a,attr:i,prop:o,style:this.getStyle(n),child:t,action:e.action});if(e.layout.align){var _={center:"center",left:"flex-start",right:"flex-end"},d=document.createElement("div"),n="display:flex;justify-content:"+_[e.layout.align]+";";return e.isRoot?(n+="width:100%;height:100%;overflow-y:auto;box-sizing: border-box;align-items:center;",d.setAttribute("style",n),d.setAttribute("data-ele-mask",!0)):d.setAttribute("style",n),d.appendChild(c),d}return c},destory:function(){var e=this.msg.plan.plan_id||"";if(window.self===window.top)document.body.removeChild(this.maskEle);else try{window.top.document.body.removeChild(this.maskEle)}catch(t){document.body.removeChild(this.maskEle)}a.info.popup_listener.onClose(e),a.info.popup_campaign_listener.onEnd(a.getSFCampaign(this.msg.plan)),this.popupCheckInstance&&this.popupCheckInstance.resetPopupIntervalWindow()}},a.ElementRender=e,a.handlerCampaign=function(e){var t=e,n=r.getUuid()(),i=t.plan.popup_window_content;if(!r.isObject(i))return t.popupFailed(1001,!1,{uuid:n,content:"",plan:t.plan}),!1;var o;if(i.content)try{o=JSON.parse(i.content)}catch(s){a.log(s)}var p=a.getSFCampaign(t.plan),l={state:"",isCustom:!1},u=!0;try{u=a.info.popup_campaign_listener.shouldStart(p)}catch(s){u=!1,a.log(s)}var c={uuid:n,content:o,plan:t.plan};switch(t.plan.strategy_id?t.plan.is_trigger?u?"CUSTOMIZED"===i.popup_type?"withoutCampaignListener"===a.info.supportCustom?l.state="CAMPAIGN_CUSTOMIZED_NULL_LISTENER":"withoutStart"===a.info.supportCustom?l.state="CAMPAIGN_CUSTOMIZED_LISTENER_NULL_START":r.isString(i.content)?l.state="CAMPAIGN_TRIGGER_CUSTOMIZED_START":l.state="DIALOG_NOT_SHOW_JSON_FAILED":"PRESET"===i.popup_type&&r.isObject(o)&&r.isObject(o.properties)&&r.isObject(o.template)?l.state="DIALOG_SHOW":l.state="DIALOG_NOT_SHOW_JSON_FAILED":l.state="CAMPAIGN_NOT_START_LISTENER_START":l.state="CAMPAIGN_NOT_START_TRIGGER":t.plan.is_control_group?l.state="DIALOG_NOT_SHOW":u?r.isObject(o)&&o.properties&&o.template?l.state="DIALOG_SHOW":l.state="DIALOG_NOT_SHOW_JSON_FAILED":l.state="CAMPAIGN_NOT_START_LISTENER_START",l.isCustom=!(!i.popup_type||"CUSTOMIZED"!==i.popup_type),a.log("campaign:",l,"plan:",t.plan.cname),l.state){case"DIALOG_SHOW":t.showPopup(c);break;case"CAMPAIGN_TRIGGER_CUSTOMIZED_START":t.customCampaign(c);break;case"CAMPAIGN_NOT_START_LISTENER_START":t.popupFailed(1004,l.isCustom,c);break;case"CAMPAIGN_CUSTOMIZED_NULL_LISTENER":t.popupFailed(1006,l.isCustom,c);break;case"CAMPAIGN_CUSTOMIZED_LISTENER_NULL_START":t.popupFailed(1006,l.isCustom,c);break;case"DIALOG_NOT_SHOW_JSON_FAILED":t.popupFailed(1001,l.isCustom,c);break;case"CAMPAIGN_NOT_START_TRIGGER":t.popupFailed(1005,l.isCustom,c);break;case"DIALOG_NOT_SHOW":t.popupFailed(1003,l.isCustom,c);break;default:a.log("CampaignState\u5f02\u5e38")}},a.track={getPublicProps:function(e){var t=e.plan,n={$sf_lib_version:a.lib_version,$sf_plan_type:"\u8fd0\u8425\u8ba1\u5212",$sf_channel_service_name:"UNIVERAL_FOCUS",$sf_channel_category:"POPUP",$sf_platform_tag:a.info.platform,$sf_msg_id:e.$sf_msg_id};return r.isEmptyObject(t)||!r.isObject(t)?n:(n.$sf_plan_id=t.plan_id+"",n.$sf_plan_strategy_id=t.strategy_id?t.strategy_id:t.is_control_group?"-1":"0",t.audience_id&&(n.$sf_audience_id=t.audience_id+""),t.section_id&&(n.$sf_section_id=String(t.section_id),n.$sf_plan_type="\u65b0\u8d44\u6e90\u4f4d"),n)},popupDisplay:function(e){var t={$sf_msg_title:e.$sf_msg_title,$sf_msg_content:e.$sf_msg_content,$sf_msg_image_url:e.$sf_msg_image_url,$sf_succeed:e.$sf_succeed,$sf_fail_reason:e.$sf_fail_reason};this.trackEvent("$PlanPopupDisplay",t,e)},trackEvent:function(e,t,n){var i=a.track.getPublicProps(n);r.extend(t,i),r.each(t,function(e,n){""!==e&&void 0!==e||delete t[n]}),a.sa.track(e,t)},maskClick:function(e){if(!e.msg)return!1;var t={$sf_close_type:"POPUP_CLOSE_MASK",$sf_msg_title:e.msg.$sf_msg_title,$sf_msg_content:e.msg.$sf_msg_content,$sf_msg_image_url:e.msg.$sf_msg_image_url,$sf_msg_element_type:"mask",$sf_msg_action_id:e.properties.maskActionId};this.trackEvent("$PlanPopupClick",t,e.msg),e.destory()},elementClickCallback:function(e,t){var n=e.target,i=n.getAttribute("data-action"),o=n.getAttribute("data-info"),s=t.msg||{};if(!i)return!1;try{var p=JSON.parse(i)||{},l=p[0],u=JSON.parse(o)||{}}catch(e){a.log("elementClickCallback error",e)}var c={type:l.type,value:r.isString(l.value)?l.value:"",extra:r.isObject(l.value)?l.value:""},_=t.msg.plan?t.msg.plan.plan_id:"",d={$sf_msg_title:s.$sf_msg_title,$sf_msg_content:s.$sf_msg_content,$sf_msg_image_url:s.$sf_msg_image_url,$sf_msg_element_type:u.$sf_msg_element_type,$sf_msg_element_content:u.$sf_msg_element_content,$sf_msg_element_action:l.type,$sf_msg_action_id:l.id,$sf_close_type:"close"===l.type?l.$sf_close_type:""};this.trackEvent("$PlanPopupClick",d,s);try{a.info.popup_listener.onClick(_,c);var f=t.msg.plan;if(f){var m={name:f.cname,plan_id:f.plan_id,content:f.popup_window_content?f.popup_window_content.content:"",type:f.popup_window_content?f.popup_window_content.popup_type:"",action:c};a.info.popup_campaign_listener.onClick(m)}}catch(e){a.log("popup_listener.onClick error",e)}if("close"===l.type)t.destory();else if(l.closeable?t.destory():null,"auto"===a.info.popup_listener.openlink&&"openlink"===l.type){if("http"!==l.value.slice(0,4))return!1;window.location.href=l.value}}};var u=a.log;a.changeCovertStatus=function(e){var t=JSON.parse(JSON.stringify(a.convertPlans));r.each(t,function(t,n){if(!t.is_in_convert_window)return!1;var i=t.is_in_convert_window.step,o=t.is_in_convert_window.uuid;return a.convertPlans[n].is_in_convert_window.step=Math.min(2*i,6e5),!!e&&void r.each(e,function(e){e.popup_display_uuid===o&&e.convert_time&&(u("--\u8f6c\u5316\u7a97\u53e3- \u76ee\u6807\u4e8b\u4ef6\u5df2\u7ecf\u5b8c\u6210 - \u6ee1\u8db3",a.convertPlans[n].plan_id),delete a.convertPlans[n].is_in_convert_window,a.convertPlans.splice(n,1))})}),a.updateDataAndSetListen.updateLocalData()},a.asyncConvert=function(e){function t(){if(r.isEmptyObject(a.localData)||!r.isArray(a.convertPlans)||0===a.convertPlans.length)return!1;var e=JSON.parse(JSON.stringify(a.convertPlans)),i=e[0].is_in_convert_window&&e[0].is_in_convert_window.step||5e3,o=[];return r.each(e,function(e,t){if(!e.is_in_convert_window)return!1;var n=(new Date).getTime(),r=e.is_in_convert_window.expire_time;return n>r?(u("--\u8f6c\u5316\u7a97\u53e3\u8d85\u65f6\u5df2\u7ecf\u8fc7\u671f - \u6ee1\u8db3",a.convertPlans[t].plan_id),delete a.convertPlans[t].is_in_convert_window,a.convertPlans.splice(t,1),a.updateDataAndSetListen.updateLocalData(),!1):(o.push(e.is_in_convert_window.uuid),e.is_in_convert_window.step||(e.is_in_convert_window.step=5e3,a.convertPlans[t].is_in_convert_window.step=5e3),void(i>e.is_in_convert_window.step&&(i=e.is_in_convert_window.step)))}),!!o.length&&(a.asyncConvert.timer&&clearTimeout(a.asyncConvert.timer),void(a.asyncConvert.timer=setTimeout(function(){r.ajax({url:a.info.api_base_url+"/sfo/popup_displays?project="+encodeURIComponent(n)+"&popup_display_uuids="+encodeURIComponent(o)+"&time="+(new Date).getTime(),type:"GET",cors:!0,credentials:!1,contentType:"application/json",success:function(e){a.changeCovertStatus(e),t()},error:function(){a.changeCovertStatus(),t()}})},i)))}var n=a.info.project,i=!1;return!(!e&&0===a.convertPlans.length)&&(e&&(r.each(a.convertPlans,function(t){t.plan_id===e.plan_id&&(i=!0)}),i||a.convertPlans.push(e)),void t())},a.ruleTime={getExpire:function(e,t){var n=t,i=Number(e.value)||0,o=Number(e.value)||0,a=String(e.unit).toLowerCase(),r=null,s={day:function(){return r=new Date(n),r.setHours(23),r.setMinutes(59),r.setSeconds(59),r.setMilliseconds(999),r=r.getTime()+864e5*(o-1)},week:function(){r=new Date(n);var e=r.getDay();0===e&&(e=7);var t=7-e;return r.setHours(23),r.setMinutes(59),r.setSeconds(59),r.setMilliseconds(999),r=r.getTime()+24*t*60*60*1e3+7*(o-1)*24*60*60*1e3},month:function(){r=new Date(n);var e=r.getMonth(),t=e+o;return t>=11?(r.setFullYear(r.getFullYear()+parseInt(t/12)),r.setMonth(t%12)):r.setMonth(t),r.setDate(1),r.setHours(0),r.setMinutes(0),r.setSeconds(0),r.setMilliseconds(0),r.getTime()},second:function(e){var t={month:2592e6,week:6048e5,day:864e5,hour:36e5,minute:6e4,second:1e3},o=null;return r=new Date(n),e in t&&(o=t[e]*i),r.getTime()+o}};return e.natural!==!0?s.second(a):a in s?s[a]():void 0},getLast:function(e,t){var n=Number(e.value)||0,i=Number(e.value)-1||0,o=String(e.unit).toLowerCase(),a=null,r={day:function(){return a=new Date(t),a.setHours(0),a.setMinutes(0),a.setSeconds(0),a.setMilliseconds(0),a=a.getTime()-864e5*i},week:function(){a=new Date(t);var e=a.getDay();return 0===e&&(e=7),--e,a.setHours(0),a.setMinutes(0),a.setSeconds(0),a.setMilliseconds(0),a=a.getTime()-(24*e*60*60*1e3+7*i*24*60*60*1e3)},month:function(){a=new Date(t);var e=a.getMonth()+1,n=e-i;return n<=0?(a.setFullYear(a.getFullYear()+(parseInt(n/12)-1)),a.setMonth(12+n%12-1)):a.setMonth(n-1),a.setDate(1),a.setHours(0),a.setMinutes(0),a.setSeconds(0),a.setMilliseconds(0),a.getTime()},second:function(e){var i={month:2592e6,week:6048e5,day:864e5,hour:36e5,minute:6e4,second:1e3},o=null;return a=new Date(t),e in i&&(o=i[e]*n),a.getTime()-o}};return e.natural!==!0?r.second(o):o in r?r[o]():void 0},getArrMatchCount:function(e,t){var n=0;for(n=0;n<e.length;n++)if(t>=e[n])return n;return e.length}},a.eventTriggerProcess=function(){if(!a.updateDataAndSetListen.active_state)return!1;if(!r.isArray(a.localData.eventQueue))return!1;if(0===a.localData.eventQueue.length)return!1;if(a.isRun)return!1;u("\u4e8b\u4ef6\u961f\u5217---eventQueue",a.localData.eventQueue);var e=!1,t=a.localData.eventQueue[0],n=a.eventRule[t.event];a.isRun=!0,a.localData.eventQueue.shift(),a.updateDataAndSetListen.updateLocalData(),r.isArray(n)&&r.isObject(n[0])&&n.length>0&&(u("--------------------\u89e6\u53d1\u4e8b\u4ef6\u5f00\u59cb--------------------"),r.each(n,function(e){r.isObject(e)&&"undefined"!=typeof e.match_state&&delete e.match_state,new a.RuleCheck(e,t)}),r.each(n,function(t){t.match_state===!0?e===!1?(e=!0,u("\u68c0\u67e5\u5b8c\u6bd5-\u4f18\u5148\u5f39\u7a97-\u5f00\u59cb",t.plan.cname),new a.PopupCheck(t,(!0))):e===!0&&(u("\u68c0\u67e5\u5b8c\u6bd5-\u975e\u4f18\u5148\u5f39\u7a97-\u4e0d\u6e32\u67d3",t.plan.cname),new a.PopupCheck(t,(!1))):u("\u68c0\u67e5\u5b8c\u6bd5-\u8ba1\u5212-\u4e0d\u6ee1\u8db3",t.plan.cname)}),e||a.completeWindowLifecycle(),u("--------------------\u89e6\u53d1\u4e8b\u4ef6\u7ed3\u675f--------------------"))},a.completeWindowLifecycle=function(){a.isRun=!1,a.eventTriggerProcess()},a.PopupCheck=function(e,t){this.plan=e.plan,this.current_time=(new Date).getTime(),t?this.renderPopup():this.hidePopup(),a.updateDataAndSetListen.updateLocalData()},a.PopupCheck.prototype.createPopupWindow=function(e,t){this.startConvertWindow(e),this.startPopupIntervalWindow(this.current_time),this.startPopupLimitWindow(),this.setGlobalLimit(),this.deletePlanAllWindow(),t&&a.completeWindowLifecycle()},a.PopupCheck.prototype.hidePopup=function(){this.deletePlanAllWindow()},a.PopupCheck.prototype.renderPopup=function(){a.handlerCampaign(this)},a.PopupCheck.prototype.popupFailed=function(e,t,n){var i={1001:"\u9884\u89c8\u4fe1\u606f\u89e3\u6790\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u8ba1\u5212\u914d\u7f6e",1003:"\u5bf9\u7167\u7ec4",1004:"campaignShouldStart \u63a5\u53e3\u8fd4\u56de false",1005:"\u8ba1\u5212\u4e0b\u53d1 is_trigger \u4e3a false",1006:"\u81ea\u5b9a\u4e49\u89e6\u8fbe\u8ba1\u5212\u672a\u5b9e\u73b0\u5f39\u7a97\u751f\u547d\u5468\u671f\u56de\u8c03"},o=i[e],s=a.getPopupInfo(n.content);s.$sf_msg_id=n.uuid,s.plan=n.plan,s.$sf_succeed=!1,s.$sf_fail_reason=o,a.track.popupDisplay(s),!t&&a.info.popup_listener&&r.isFunction(a.info.popup_listener.onLoadFailed)&&a.info.popup_listener.onLoadFailed(n.plan.plan_id,e,o),a.info.popup_campaign_listener.onFailed(a.getSFCampaign(n.plan),e,o),this.createPopupWindow(n.uuid,!0)},a.PopupCheck.prototype.customCampaign=function(e){var t=a.getSFCampaign(e.plan),n=a.getPopupInfo(e.content);n.$sf_msg_id=e.uuid,n.plan=e.plan,n.$sf_succeed=!0,a.track.popupDisplay(n),a.info.popup_campaign_listener.onStart(t),this.createPopupWindow(e.uuid,!0)},a.PopupCheck.prototype.showPopup=function(e){if(!a.ElementRender)return a.log("\u6682\u4e0d\u652f\u6301\u9884\u7f6e\u5f39\u7a97UI"),!1;var t=new a.ElementRender(e.content),n=a.getPopupInfo(e.content);n.$sf_msg_id=e.uuid,n.plan=e.plan,n.$sf_succeed=!0,r.extend(t.msg,n),t.popupCheckInstance=this,a.track.popupDisplay(n);var i=t.render();return i?(a.info.popup_campaign_listener.onStart(a.getSFCampaign(e.plan)),this.createPopupWindow(e.uuid),void a.info.popup_listener.onLoadSuccess(e.plan.plan_id)):(u("\u5f53\u524d\u9875\u9762\u5df2\u6709\u4e00\u4e2a\u5f39\u6846\u6b63\u5728\u6e32\u67d3\uff0c\u672c\u6b21\u5f39\u6846\u4e0d\u6e32\u67d3\uff01"),!1)},a.PopupCheck.prototype.startConvertWindow=function(e){u("--\u5f39\u7a97\u5c55\u793a-\u8f6c\u5316\u7a97\u53e3\u8bbe\u7f6e",this.plan.cname),r.isObject(this.plan.convert_window)&&this.plan.convert_window.value&&(this.plan.is_in_convert_window={expire_time:a.ruleTime.getExpire(this.plan.convert_window,this.current_time),start_time:this.current_time,uuid:e},a.asyncConvert(this.plan))},a.PopupCheck.prototype.startPopupIntervalWindow=function(e){r.isObject(this.plan.popup_interval)&&this.plan.popup_interval.value&&(this.plan.is_in_popup_interval_window=a.ruleTime.getExpire(this.plan.popup_interval,e))},a.PopupCheck.prototype.resetPopupIntervalWindow=function(){var e=(new Date).getTime();this.startPopupIntervalWindow(e),this.resetGlobalLimit(e),a.completeWindowLifecycle()},a.PopupCheck.prototype.startPopupLimitWindow=function(){u("--\u5f39\u7a97\u5c55\u793a-\u53c2\u4e0e\u9650\u5236\u7a97\u53e3\u8bbe\u7f6e\u91cd\u7f6e"),
r.isObject(this.plan.re_enter)&&this.plan.re_enter.value&&(r.isObject(this.plan.is_in_popup_limit_window)?this.plan.is_in_popup_limit_window.count++:this.plan.is_in_popup_limit_window={expire_time:a.ruleTime.getExpire(this.plan.re_enter,this.current_time),count:1})},a.PopupCheck.prototype.setGlobalLimit=function(){u("--\u5f39\u7a97\u5c55\u793a-\u5168\u5c40\u5f39\u7a97\u6b21\u6570\u8bbe\u7f6e"),r.isArray(a.localData.global_popup_count)||(a.localData.global_popup_count=[]),a.localData.global_popup_count.unshift(this.current_time);for(var e=a.localData.global_popup_count,t=e[e.length-1];t+7776e6<this.current_time||e.length>3e3;)e.pop(),t=e[e.length-1]},a.PopupCheck.prototype.resetGlobalLimit=function(e){r.isArray(a.localData.global_popup_count)&&a.localData.global_popup_count.length>0&&(a.localData.global_popup_count.shift(),a.localData.global_popup_count.unshift(e))},a.PopupCheck.prototype.deletePlanAllWindow=function(){var e=this.plan.pattern_popup.matcher_list;r.isArray(e)&&r.each(e,function(e){e.is_in_window&&(u("--\u5f39\u7a97\u5c55\u793a-\u91cd\u7f6e\u5404\u4e2a\u89c4\u5219\u7684\u7a97\u53e3\u8ba1\u7b97-\u6210\u529f"),delete e.is_in_window)})},a.RuleCheck=function(e,t){this.plan_match=e,this.plan=e.plan,this.rule_arr=e.rule,this.event_data=t,this.current_time=(new Date).getTime();var n="-------------\u68c0\u67e5-\u8ba1\u5212-("+this.plan.cname+")";r.each(this.rule_arr,function(e){n+="--\u5305\u542b\u89c4\u5219-("+e.event_name+"\uff09-\u89e6\u53d1"+e.params[0]+"\u6b21"}),u(n),u(this.plan),this.checkPlanIsExpire(),a.updateDataAndSetListen.updateLocalData()},a.RuleCheck.prototype.checkPlanIsExpire=function(){!this.plan.expire_at||r.isNumber(this.plan.expire_at)&&this.current_time<this.plan.expire_at?(u("--\u8fc7\u671f-\u6ee1\u8db3",this.plan.cname),this.checkPlanIsAudience()):u("--\u8fc7\u671f-\u4e0d\u6ee1\u8db3",this.plan.cname)},a.RuleCheck.prototype.checkPlanIsAudience=function(){this.plan.is_audience===!0?(u("--\u662f\u5426\u53d7\u4f17-\u6ee1\u8db3",this.plan.cname),this.checkPlanSuspend()):u("--\u662f\u5426\u53d7\u4f17-\u4e0d\u6ee1\u8db3",this.plan.cname)},a.RuleCheck.prototype.checkPlanSuspend=function(){this.plan.status&&"SUSPEND"===this.plan.status?u("--\u6682\u505c-\u4e0d\u6ee1\u8db3",this.plan.cname):(u("--\u6682\u505c-\u6ee1\u8db3",this.plan.cname),this.checkConvert())},a.RuleCheck.prototype.checkConvert=function(){if(r.isObject(this.plan.is_in_convert_window)&&this.plan.is_in_convert_window.expire_time>this.current_time)u("--\u5b58\u5728\u8f6c\u5316\u7a97\u53e3 - \u4e0d\u6ee1\u8db3",this.plan.is_in_convert_window);else if(r.isObject(this.plan.is_in_convert_window)&&this.current_time>this.plan.is_in_convert_window.expire_time){u("--\u8f6c\u5316\u7a97\u53e3\u8d85\u65f6\u5df2\u7ecf\u8fc7\u671f - \u6ee1\u8db3",this.plan.plan_id),delete this.plan.is_in_convert_window;for(var e=0;e<a.convertPlans.length;e++)this.plan.plan_id===a.convertPlans[e].plan_id&&(a.convertPlans.splice(e,1),e--);this.checkGlobalPopupInterval()}else u("--\u4e0d\u5b58\u5728\u8f6c\u5316\u7a97\u53e3 - \u6ee1\u8db3",this.plan.is_in_convert_window),this.checkGlobalPopupInterval()},a.RuleCheck.prototype.checkGlobalPopupInterval=function(){var e=a.localData.global_popup_count;if(r.isArray(e)&&e.length>=1){var t=a.ruleTime.getLast(a.localData.popup_interval_global,this.current_time);t>e[0]?(u("--\u5168\u5c40\u5f39\u7a97\u95f4\u9694-\u6ee1\u8db3-"+t+">\u4e0a\u6b21\u5f39\u7a97\u65f6\u95f4"+e[0]),this.checkPopupInterval()):u("\u68c0\u67e5-\u5168\u5c40\u5f39\u7a97\u95f4\u9694-\u4e0d\u6ee1\u8db3-"+t+"<\u4e0a\u6b21\u5f39\u7a97\u65f6\u95f4"+e[0])}else u("--\u5168\u5c40\u5f39\u7a97\u95f4\u9694-\u6ca1\u6709\u5f39\u8fc7\u7a97-\u6ee1\u8db3"),this.checkPopupInterval()},a.RuleCheck.prototype.checkPopupInterval=function(){var e=!0;r.isNumber(this.plan.is_in_popup_interval_window)?this.current_time>this.plan.is_in_popup_interval_window?(u("--\u5f39\u7a97\u95f4\u9694-\u5f53\u524d\u65f6\u95f4\u5927\u4e8e\u56fa\u5b9a\u5f39\u7a97\u95f4\u9694-\u6ee1\u8db3"),this.plan.is_in_popup_interval_window=null):(u("--\u5f39\u7a97\u95f4\u9694-\u5f53\u524d\u65f6\u95f4\u5c0f\u4e8e\u56fa\u5b9a\u5f39\u7a97\u95f4\u9694-\u4e0d\u6ee1\u8db3"),e=!1):(u("--\u5f39\u7a97\u95f4\u9694-\u7a97\u53e3\u4e0d\u5b58\u5728-\u65b0\u5f00"),this.plan.is_in_popup_interval_window=null),e&&this.checkPermission()&&this.checkProperties()},a.RuleCheck.prototype.isMatched=function(e){var t={equal:function(e,t){if(!r.isNumber(e)&&!r.isString(e))return!1;for(var n=0,i=t.length;n<i;n++){if(!r.isNumber(t[n])&&!r.isString(t[n]))return!1;if(r.isString(e)){var o=r.isString(t[n])?t[n]:String(t[n]);if(e===o)return!0}else if(r.getConvertNumberValue(e)===r.getConvertNumberValue(t[n]))return!0}return!1},notEqual:function(e,t){if(!r.isNumber(e)&&!r.isString(e))return!1;for(var n=0,i=t.length;n<i;n++){if(!r.isNumber(t[n])&&!r.isString(t[n]))return!1;if(r.isString(e)){var o=r.isString(t[n])?t[n]:String(t[n]);if(e===o)return!1}else if(r.getConvertNumberValue(e)===r.getConvertNumberValue(t[n]))return!1}return!0},contain:function(e,t){return!!r.isString(e)&&e.indexOf(t[0])>=0},notContain:function(e,t){return!!r.isString(e)&&e.indexOf(t[0])===-1},isTrue:function(e){return e===!0},isFalse:function(e){return e===!1},isSet:function(e){return"undefined"!=typeof e},notSet:function(e){return"undefined"==typeof e},isEmpty:function(e){if(!r.isString(e)&&!r.isArray(e))return!1;if(r.isString(e))return""===e;for(var t=0;t<e.length;t++){var n=e[t].replace(/^\s+|\s+$/g,"");if(""!==n)return!1}return!0},isNotEmpty:function(e){if(!r.isString(e)&&!r.isArray(e))return!1;if(r.isString(e))return""!==e;for(var t=0;t<e.length;t++){var n=e[t].replace(/^\s+|\s+$/g,"");if(""===n)return!1}return!0},less:function(e,t){return!!r.isNumber(e)&&("undefined"!=typeof t[0]&&r.getConvertNumberValue(e)<r.getConvertNumberValue(t[0]))},greater:function(e,t){return!!r.isNumber(e)&&("undefined"!=typeof t[0]&&r.getConvertNumberValue(e)>r.getConvertNumberValue(t[0]))},between:function(e,t){if(!r.isNumber(e))return!1;if("undefined"==typeof t[0]&&"undefined"==typeof t[1])return!1;var n=r.getConvertNumberValue(e),i=r.getConvertNumberValue(t[0]),o=r.getConvertNumberValue(t[1]);return n>=i&&n<=o},isIn:function(e,t){if(!r.isArray(e))return!1;for(var n=0;n<e.length;n++)if(r.indexOf(t,e[n])>=0)return!0;return!1},notInclude:function(e,t){if(!r.isArray(e))return!1;for(var n=0;n<e.length;n++)if(r.indexOf(t,e[n])===-1)return!0;return!1},absolute_between:function(e,t){try{var n=new Date(t[0]),i=new Date(t[1]),o=new Date(e);return o>=n&&o<=i}catch(a){u("absolute_between Error",a)}},absoluteBetween:function(e,t){try{var n=new Date(t[0]),i=new Date(t[1]),o=new Date(e);return o>=n&&o<=i}catch(a){u("absolute_between Error",a)}}},n=this,i=e.relation,o="or"===String(i).toLowerCase(),a="and"===String(i).toLowerCase(),s=!!a,p=!0;return r.each(e.conditions,function(e){if(!p)return!1;if(!e.field)return!1;var i=e.field.lastIndexOf("."),r=e.params,l="in"===e["function"]?"isIn":e["function"];if(!t[l])return s=!1,p=!1,!1;if(i<0)return!1;var u=e.field.slice(i+1),c=n.event_data.properties,_=c[u];"$event_duration"===u&&void 0===_&&(_=c.event_duration);var d=t[l](_,r);o&&d&&(s=!0,p=!1),a&&!d&&(s=!1,p=!1)}),s},a.RuleCheck.prototype.checkProperties=function(){var e=this,t=r.filter(this.rule_arr,function(t){var n=t.multi_filter?t.multi_filter:t.filter;return!(n&&(!n.conditions||0!==n.conditions.length))||e.isMatched(n)});r.isArray(t)&&t.length>0?(this.checkWindowAndMatch(t),u("--\u5c5e\u6027\u5339\u914d-\u6ee1\u8db3",t)):u("--\u5c5e\u6027\u5339\u914d-\u4e0d\u6ee1\u8db3")},a.RuleCheck.prototype.checkPermission=function(){function e(t){r.each(t,function(t){if(o=s([t]),r.isArray(o)&&o.length>0){var n=t.filters||[];n&&n.length>0&&e(n)}})}var t=this.plan.event_permission;if(!r.isObject(t)||r.isEmptyObject(t))return!0;var n=[t],i=this,o=[],s=function(e){var t=r.filter(e,function(e){return!(e&&e.conditions&&(!e.conditions||0!==e.conditions.length))||i.isMatched(e)});return t};return e(n),r.isArray(o)&&o.length>0?(a.log("--\u89d2\u8272\u5c5e\u6027\u5339\u914d-\u6ee1\u8db3",o),!0):(a.log("--\u89d2\u8272\u5c5e\u6027\u5339\u914d-\u4e0d\u6ee1\u8db3"),!1)},a.RuleCheck.prototype.checkWindowAndMatch=function(e){var t=this,n=[];r.each(e,function(e){if(!e.params||!e.params[0])return u("--\u7a97\u53e3\u671f\u548c\u6b21\u6570-\u89c4\u5219\u6570\u636e\u5f02\u5e38"),!1;var i=Number(e.params[0]);1===i?n.push(e):i>1&&r.isObject(e.window)&&e.window.value>0&&(!r.isObject(e.is_in_window)||!r.isNumber(e.is_in_window.expire_time)||e.is_in_window.expire_time<t.current_time?e.is_in_window={expire_time:a.ruleTime.getExpire(e.window,t.current_time),count:1}:e.is_in_window.count=e.is_in_window.count+1,e.is_in_window.count>=i?n.push(e):u("--\u7a97\u53e3\u671f\u548c\u6b21\u6570-\u89c4\u5219\u6570",e.is_in_window.count,"\u4e0d\u5339\u914d\u5f53\u524d\u6b21\u6570",i))}),n.length>0?(u("--\u7a97\u53e3\u671f\u548c\u6b21\u6570-\u6709\u5339\u914d\u6210\u529f\u7684\u89c4\u5219",n),this.checkGlobalPopupLimit()):u("--\u7a97\u53e3\u671f\u548c\u6b21\u6570-\u6ca1\u6709\u5339\u914d\u6210\u529f\u7684\u89c4\u5219",n)},a.RuleCheck.prototype.checkGlobalPopupLimit=function(){var e=a.localData.msg_limit_global,t=!0,n=this;r.isObject(e)&&e.is_in_use===!0&&r.isArray(e.limits)&&r.isArray(a.localData.global_popup_count)&&this.plan.global_msg_limit_enabled===!0?(r.each(e.limits,function(e){if(r.isObject(e)&&r.isNumber(e.limit)){var i=a.ruleTime.getLast(e,n.current_time),o=a.ruleTime.getArrMatchCount(a.localData.global_popup_count,i);u("--\u5168\u5c40\u5f39\u7a97\u9650\u5236-\u5df2\u7ecf\u5f39\u7a97\u6b21\u6570-"+o+"-\u9650\u5236\u7684\u6b21\u6570"+e.limit+"-\u9650\u5236\u65f6\u95f4-"+i),t=o<e.limit?t&&!0:t&&!1}}),t?(u("--\u5168\u5c40\u5f39\u7a97\u9650\u5236- \u6ee1\u8db3"),this.checkPopupLimit()):u("--\u5168\u5c40\u5f39\u7a97\u9650\u5236-\u4e0d\u6ee1\u8db3")):(u("--\u5168\u5c40\u5f39\u7a97\u9650\u5236- \u6ee1\u8db3"),this.checkPopupLimit())},a.RuleCheck.prototype.checkPopupLimit=function(){return r.isObject(this.plan.re_enter)&&r.isNumber(this.plan.re_enter.value)&&r.isNumber(this.plan.re_enter.limit)?void(r.isObject(this.plan.is_in_popup_limit_window)&&r.isNumber(this.plan.is_in_popup_limit_window.expire_time)&&r.isNumber(this.plan.is_in_popup_limit_window.count)?this.plan.is_in_popup_limit_window.expire_time<this.current_time?(u("--\u53c2\u4e0e\u9650\u5236-\u8d85\u8fc7\u4e86\u53c2\u4e0e\u9650\u5236\u7a97\u53e3-\u5f00\u542f\u65b0\u7a97\u53e3-\u6ee1\u8db3",this.plan.is_in_popup_limit_window),delete this.plan.is_in_popup_limit_window,this.plan_match.match_state=!0):this.plan.is_in_popup_limit_window.count<this.plan.re_enter.limit?(u("--\u53c2\u4e0e\u9650\u5236-\u5728\u7a97\u53e3\u5185\u4e14\u5728\u53c2\u4e0e\u9650\u5236\u6b21\u6570\u5185-\u6ee1\u8db3",this.plan.is_in_popup_limit_window),this.plan_match.match_state=!0):u("--\u53c2\u4e0e\u9650\u5236-\u5728\u7a97\u53e3\u5185\u4f46\u662f\u8d85\u8fc7\u4e86\u53c2\u4e0e\u9650\u5236-\u4e0d\u6ee1\u8db3",this.plan.is_in_popup_limit_window):(this.plan.is_in_popup_limit_window?(u("--\u53c2\u4e0e\u9650\u5236-\u6709\u7a97\u53e3\u4f46\u662f\u7a97\u53e3\u6570\u636e\u5f02\u5e38-\u5f00\u65b0\u7a97\u53e3-\u6ee1\u8db3",this.plan.is_in_popup_limit_window),delete this.plan.is_in_popup_limit_window):u("--\u53c2\u4e0e\u9650\u5236-\u4e0d\u5b58\u5728\u7a97\u53e3-\u5f00\u65b0\u7a97\u53e3-\u6ee1\u8db3",this.plan.is_in_popup_limit_window),this.plan_match.match_state=!0)):(this.plan_match.match_state=!0,!1)};var c="dfm-enc-";return a.store={delete_time:2592e6,init:function(){this.migrateLocalData(),a.localData=this.getLocalData(),r.isNumber(a.localData.config_pull_interval_ms)&&a.localData.config_pull_interval_ms>0&&(a.updateDataAndSetListen.interval_time=a.localData.config_pull_interval_ms),this.removeLocalData(),a.log("\u521d\u59cb\u5316-\u83b7\u53d6-\u5185\u5b58-localData")},getJSONData:function(){var e=r.localStorage.get(a.config.storageName);r.isString(e)&&(e=n(e));try{e=JSON.parse(e)}catch(t){r.log(t)}return e},saveJSONData:function(e){e=JSON.stringify(e),a.info.encrypt_cookie&&(e=i(e)),r.localStorage.set(a.config.storageName,e)},migrateLocalData:function(){var e=this.getJSONData()||{},t=a.sa.store.getDistinctId();if(e.popup_sdk_users&&e.popup_sdk_plans)return!1;var n={popup_sdk_plans:{},popup_sdk_users:{}};n.popup_sdk_plans[t]=e,n.popup_sdk_users[t]={user_id:t},this.saveJSONData(n)},getLocalData:function(){var e=this.getJSONData(),t=a.sa.store.getDistinctId(),n=null;return e?(r.isObject(e.popup_sdk_users[t])&&e.popup_sdk_users[t].user_id&&(n=e.popup_sdk_users[t].user_id),n&&r.isObject(e.popup_sdk_plans[n])?(e.popup_sdk_plans[n].update_time=(new Date).getTime(),this.saveJSONData(e),e.popup_sdk_plans[n]):{}):{}},saveLocalData:function(){var e=this.getJSONData(),t=a.sa.store.getDistinctId(),n=null;return!!e&&void(e.popup_sdk_users&&r.isObject(e.popup_sdk_users[t])&&e.popup_sdk_users[t].user_id&&(n=e.popup_sdk_users[t].user_id,e.popup_sdk_plans[n]=a.localData,this.saveJSONData(e)))},removeLocalData:function(){var e=this.getJSONData(),t=this.delete_time;if(!e||!e.popup_sdk_plans||!e.popup_sdk_users)return!1;var n=JSON.parse(JSON.stringify(e.popup_sdk_plans)),i=JSON.parse(JSON.stringify(e.popup_sdk_users)),o=(new Date).getTime(),a=[];r.each(n,function(n,i){o-n.update_time>t&&(delete e.popup_sdk_plans[i],a.push(i))}),r.each(i,function(t,n){a.length>0&&r.each(a,function(i){t.user_id&&i===t.user_id&&delete e.popup_sdk_users[n]})}),this.saveJSONData(e)}},a.updateDataAndSetListen={active_state:!0,interval_time:6e5,save_interval:null,data_interval:null,image_list:null,local_data:null,filterConvertPlans:function(){var e=a.localData.popup_plans;if(!e||!r.isArray(e))return!1;var t=r.filter(e,function(e){return!!e.convert_window&&!!e.is_in_convert_window});a.convertPlans=t,a.log("\u521d\u59cb\u5316-\u5f02\u6b65\u7684convertWindow",a.convertPlans),a.asyncConvert()},diffData:function(){var e=a.localData,t=JSON.parse(JSON.stringify(a.serverData));(new Date).getTime();if(!t||r.isEmptyObject(t))return!1;if(!e||r.isEmptyObject(e)||!e.popup_plans||0===e.popup_plans.length)return r.extend(a.localData,t),!1;var n=t.popup_plans;r.each(n,function(t,i){var o=null;if(r.each(e.popup_plans,function(e){e.plan_id===t.plan_id&&(o=e,t.audience_id||delete o.audience_id,r.isObject(t.window_update)&&r.each(t.window_update,function(e,n){o.window_update&&o.window_update[n]===e||("trigger_window"===n?o.pattern_popup.matcher_list=t.pattern_popup.matcher_list:"convert_window"===n&&o.is_in_convert_window&&t.convert_window&&o.is_in_convert_window.start_time&&(o.is_in_convert_window.expire_time=a.ruleTime.getExpire(t.convert_window,o.is_in_convert_window.start_time)))}))}),!o)return!1;if(!t.window_update&&o.last_update_config_time!==t.last_update_config_time)return!1;var s=o.pattern_popup.matcher_list;r.extend2Lev(o,t),o.pattern_popup.matcher_list=s,n[i]=o}),r.extend(a.localData,t)},getEventRule:function(){var e=a.localData.popup_plans,t={};return!(!e||!r.isArray(e))&&(r.each(e,function(e){var n=e.pattern_popup.matcher_list;r.each(n,function(n){var i={plan:e,rule:[n]},o=n.event_name,a=!1;if(t[o]){if(r.each(t[o],function(t){t.plan.plan_id===e.plan_id&&(t.rule.push(n),a=!0)}),a)return!1;t[o].push(i)}else t[o]=[i]})}),r.each(t,function(e){e.sort(function(e,t){var n=t.plan.absolute_priority-e.plan.absolute_priority;return 0===n?t.plan.plan_id-e.plan.plan_id:n})}),a.eventRule=t,a.log("\u521d\u59cb\u5316-\u5f97\u5230\u4e8b\u4ef6\u548c\u8ba1\u5212\u7684\u5173\u7cfb"),void a.log("--------------------\u521d\u59cb\u5316\u5b8c\u6210--------------------\u7b49\u5f85\u4e8b\u4ef6\u89e6\u53d1\u8ba1\u5212--------------------"))},registerListen:function(){var e=this;a.sa.events.on("send",function(t){t.event&&a.eventRule[t.event]&&(r.isArray(a.localData.eventQueue)||(a.localData.eventQueue=[]),a.localData.eventQueue.push(t),e.updateLocalData(),a.eventTriggerProcess())}),a.sa.events.on("changeDistinctId",function(t){e.changeId()}),a.sa.events.isReady()},setListenEvent:function(){this.diffData(),this.filterConvertPlans(),this.getEventRule(),this.updateLocalData()},loadImage:function(e){function t(e){var t=new Image;t.src=e}if(e.length<1)return!1;if(JSON.stringify(e)===JSON.stringify(this.image_list))return!1;this.image_list=e;for(var n=0;n<e.length;n++)t(e[n])},getDataFromServer:function(e,t){var n=this,i=encodeURIComponent(a.sa.store.getDistinctId()),o=encodeURIComponent(a.info.platform),s=encodeURIComponent(a.info.project);e=r.isFunction(e)?e:function(){},t=r.isFunction(t)?t:function(){},r.ajax({url:a.info.api_base_url+"/sfo/user_popup_configs?distinct_id="+i+"&platform="+o+"&project="+s+"&time="+(new Date).getTime()+"&sdk_version="+a.lib_version,type:"GET",cors:!0,credentials:!1,contentType:"application/json",success:function(i){return n.active_state?(a.log("\u521d\u59cb\u5316-\u4fee\u6539-serverData-ajax\u83b7\u53d6"),r.isObject(i)&&i.server_current_time&&i.popup_plans&&/\d+\.\d+/.test(i.min_sdk_version_required)&&parseFloat(i.min_sdk_version_required)<=parseFloat(a.lib_version)?(a.serverData=i,r.isNumber(i.config_pull_interval_ms)&&i.config_pull_interval_ms>0&&(n.interval_time=i.config_pull_interval_ms),a.serverData.local_update_time=(new Date).getTime(),a.info.preload_image&&n.loadImage(a.getImageList(i.popup_plans)),n.updateUserPlans(),n.setListenEvent()):(a.log("\u521d\u59cb\u5316-\u6570\u636e\u5f02\u5e38-\u8bf7\u6c42\u8fd4\u56de\u7684\u6570\u636e\u9519\u8bef-\u4e2d\u6b62"),a.serverData={},a.localData={},n.updateLocalData()),e(),void n.setIntervalTime(n.interval_time)):(t(),!1)},error:function(){return n.active_state?(a.log("\u521d\u59cb\u5316-\u6570\u636e\u5f02\u5e38-\u8bf7\u6c42\u9519\u8bef-\u4e2d\u6b62"),a.serverData={},e(),void n.setIntervalTime(n.interval_time)):(t(),!1)}})},updateUserPlans:function(){var e=a.store.getJSONData(),t=a.sa.store.getDistinctId(),n=a.serverData.user_id;e.popup_sdk_users[t]={user_id:n||t},n?e.popup_sdk_plans[n]?a.localData=e.popup_sdk_plans[n]:e.popup_sdk_plans[t]&&(a.localData=e.popup_sdk_plans[t],delete e.popup_sdk_plans[t]):e.popup_sdk_plans[t]&&(a.localData=e.popup_sdk_plans[t]),a.localData.update_time=(new Date).getTime(),a.store.saveJSONData(e)},setIntervalTime:function(e){var t=this;this.data_interval=setTimeout(function(){a.log("10\u5206\u949f\u5b9a\u65f6\u66f4\u65b0\u6570\u636e\u5f00\u59cb-------"),t.getDataFromServer()},e)},setFirstListen:function(){var e=this;this.getDataFromServer(function(){e.registerListen()})},updateLocalData:function(){var e=JSON.stringify(a.localData);this.local_data!==e&&(this.local_data=e,a.store.saveLocalData())},initial:function(){a.store.init();var e=a.localData.local_update_time,t=(new Date).getTime();if(r.isNumber(e)){var n=t-e;n<=0||n>=this.interval_time?this.setFirstListen():(this.setIntervalTime(this.interval_time-n),this.setListenEvent(),this.registerListen(),a.info.preload_image&&this.loadImage(a.getImageList(a.localData.popup_plans)))}else this.setFirstListen()},changeId:function(){this.stopAllState(),this.startState({getLocalData:!1})},stopAllState:function(){this.active_state=!1,a.eventRule={},this.data_interval&&window.clearTimeout(this.data_interval),this.save_interval&&window.clearInterval(this.save_interval),a.asyncConvert.timer&&window.clearTimeout(a.asyncConvert.timer),a.convertPlans=[],a.localData={},this.resetState()},resetState:function(){return"WEB"!==a.info.platform&&void(!document.querySelector("div[data-sf-mask]")&&a.isRun&&(a.isRun=!1))},startState:function(e){this.active_state=!0,e=e||{getLocalData:!0},e.getLocalData&&(this.resetState(),a.localData=a.store.getLocalData()),this.getDataFromServer()}},a.testSend={hasParam:function(){var e=r.URL(window.location.href).searchParams,t=e.get("sf_popup_test")||"",n=e.get("popup_window_id")||"",i=e.get("platform");return!(!t||!n)&&{sf_popup_test:t,popup_window_id:n,platform:i}},start:function(){var e=a.info.project,t=a.info.platform,n=this.hasParam().popup_window_id,i=this.hasParam().platform,o=encodeURIComponent(a.sa.store.getDistinctId());return"WEB"===i?(a.log("WEB\u7aef\u6d4b\u8bd5\u5f39\u7a97\u8bf7\u5728PC\u8bbe\u5907\u6253\u5f00\uff01"),!1):void r.ajax({url:a.info.api_base_url+"/sfo/popup_windows/"+n+"?project="+encodeURIComponent(e)+"&time="+(new Date).getTime()+"&sdk_version="+a.lib_version+"&platform="+encodeURIComponent(t)+"&distinct_id="+o,type:"GET",credentials:!1,cors:!0,contentType:"application/json",success:function(e){var t,n=r.getUuid();r.isObject(e)||(a.sa.log("\u6d4b\u8bd5\u5f39\u7a97-\u670d\u52a1\u7aef\u6570\u636e\u683c\u5f0f\u4e0d\u5408\u6cd5",e),e={});try{t=JSON.parse(e.content)}catch(i){a.sa.log("\u6d4b\u8bd5\u5f39\u7a97-content\u89e3\u6790\u5931\u8d25,content:",e,i)}var o=a.getPopupInfo(t);o.$sf_msg_id=n;var s={content:e.content,type:e.popup_type||"PRESET"};if(Object.hasOwnProperty.call(e,"name")&&(s.name=e.name),e.popup_type&&"CUSTOMIZED"===e.popup_type)r.isString(e.content)?"withoutCampaignListener"===a.info.supportCustom||"withoutStart"===a.info.supportCustom?(o.$sf_succeed=!1,o.$sf_fail_reason="\u81ea\u5b9a\u4e49\u89e6\u8fbe\u8ba1\u5212\u672a\u5b9e\u73b0\u5f39\u7a97\u751f\u547d\u5468\u671f\u56de\u8c03",a.track.popupDisplay(o),a.info.popup_campaign_listener.onFailed(s,1006,"\u81ea\u5b9a\u4e49\u89e6\u8fbe\u8ba1\u5212\u672a\u5b9e\u73b0\u5f39\u7a97\u751f\u547d\u5468\u671f\u56de\u8c03")):(o.$sf_succeed=!0,a.track.popupDisplay(o),a.info.popup_campaign_listener.onStart(s)):(o.$sf_succeed=!1,o.$sf_fail_reason="\u9884\u89c8\u4fe1\u606f\u89e3\u6790\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u8ba1\u5212\u914d\u7f6e",a.track.popupDisplay(o),a.info.popup_campaign_listener.onFailed(s,1001,"\u9884\u89c8\u4fe1\u606f\u89e3\u6790\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u8ba1\u5212\u914d\u7f6e"));else if(r.isObject(t)&&r.isObject(t.properties)&&r.isObject(t.template)){var p=new a.ElementRender(t);p.render(),o.$sf_succeed=!0,a.track.popupDisplay(o),a.info.popup_campaign_listener.onStart(s),a.info.popup_listener.onLoadSuccess()}else o.$sf_succeed=!1,o.$sf_fail_reason="\u9884\u89c8\u4fe1\u606f\u89e3\u6790\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u8ba1\u5212\u914d\u7f6e",a.track.popupDisplay(o),a.info.popup_listener.onLoadFailed("",1001,"\u9884\u89c8\u4fe1\u606f\u89e3\u6790\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u8ba1\u5212\u914d\u7f6e"),a.info.popup_campaign_listener.onFailed(s,1001,"\u9884\u89c8\u4fe1\u606f\u89e3\u6790\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u8ba1\u5212\u914d\u7f6e")},error:function(e){a.log("\u6d4b\u8bd5\u5f39\u7a97\u83b7\u53d6\u6570\u636e\u9519\u8bef",e)}})}},a.setPara=function(e){r.isObject(e)||(e={}),a.info=r.extend({},a.defaultPara,e);var t=a.sa;if(!t)return a.log("web js sdk \u8fd8\u6ca1\u6709\u521d\u59cb\u5316\u5b8c\u6210"),!1;if(t.para.encrypt_cookie===!0&&(a.info.encrypt_cookie=!0),!r.isString(a.info.api_base_url)||"http"!==a.info.api_base_url.slice(0,4))return a.log("popup \u5fc5\u987b\u586b\u5199\u6709\u6548 api_base_url"),!1;if("http:"===a.info.api_base_url.slice(0,5)&&"https:"===location.protocol)return a.log("\u60a8\u7684\u5f53\u524d\u9875\u9762\u662fhttps\u7684\u5730\u5740\uff0capi_base_url \u4e5f\u5fc5\u987b\u662fhttps\uff01"),!1;if(a.info.api_base_url="/"===a.info.api_base_url.slice(-1)?a.info.api_base_url.slice(0,-1):a.info.api_base_url,!r.isString(t.para.server_url)||"http"!==t.para.server_url.slice(0,4))return a.log("server_url \u5fc5\u987b\u586b\u5199\u6709\u6548\u6570\u636e\u63a5\u6536\u5730\u5740"),!1;if(a.info.project||(a.info.project=r.URL(t.para.server_url).searchParams.get("project")||"default"),r.isObject(a.info.popup_listener)){var n=a.info.popup_listener;r.isFunction(n.onClick)||(a.info.popup_listener.onClick=function(){}),r.isFunction(n.onLoadSuccess)||(a.info.popup_listener.onLoadSuccess=function(){}),r.isFunction(n.onLoadFailed)||(a.info.popup_listener.onLoadFailed=function(){}),r.isFunction(n.onClose)||(a.info.popup_listener.onClose=function(){}),r.isString(n.openlink)?"auto"!==n.openlink&&"customize"!==n.openlink&&(a.info.popup_listener.openlink="customize"):a.info.popup_listener.openlink="customize"}else a.info.popup_listener={onClick:function(){},onLoadSuccess:function(){},onLoadFailed:function(){},onClose:function(){},openlink:"customize"};return a.info.supportCustom=!0,r.isObject(a.info.popup_campaign_listener)?(r.isFunction(a.info.popup_campaign_listener.shouldStart)||(a.info.popup_campaign_listener.shouldStart=function(){return!0}),r.isFunction(a.info.popup_campaign_listener.onStart)||(a.info.supportCustom="withoutStart",a.info.popup_campaign_listener.onStart=function(){}),r.isFunction(a.info.popup_campaign_listener.onEnd)||(a.info.popup_campaign_listener.onEnd=function(){}),r.isFunction(a.info.popup_campaign_listener.onFailed)||(a.info.popup_campaign_listener.onFailed=function(){}),r.isFunction(a.info.popup_campaign_listener.onClick)||(a.info.popup_campaign_listener.onClick=function(){})):(a.info.supportCustom="withoutCampaignListener",a.info.popup_campaign_listener={shouldStart:function(){return!0},onClick:function(){},onStart:function(){},onEnd:function(){},onFailed:function(){}}),!0},a.getBridgeState=function(){return!r.isObject(a.sa.para.app_js_bridge)||!a.sa.para.app_js_bridge.is_mui&&(!a.sa.bridge||!a.sa.bridge.is_verify_success)},a.init=function(){var e=window.UniversalStatistics201505;if(a.sa=e,e&&e.readyState&&e.readyState.state>=3||!e.on)o.apply(this,arguments);else{var t=this,n=arguments;e&&e.on("sdkReady",function(){o.apply(t,n)})}},a.plugin_name="Popup",window.UniversalStatistics201505&&window.UniversalStatistics201505.modules.Popup?window.UniversalStatistics201505.modules.Popup=window.UniversalStatistics201505.modules.Popup||a:window.UniversalStatistics201505.modules.Popup=a,a});